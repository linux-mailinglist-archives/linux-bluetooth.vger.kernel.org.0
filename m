Return-Path: <linux-bluetooth-owner@vger.kernel.org>
X-Original-To: lists+linux-bluetooth@lfdr.de
Delivered-To: lists+linux-bluetooth@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 4B10032FAB
	for <lists+linux-bluetooth@lfdr.de>; Mon,  3 Jun 2019 14:31:48 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726968AbfFCMbr (ORCPT <rfc822;lists+linux-bluetooth@lfdr.de>);
        Mon, 3 Jun 2019 08:31:47 -0400
Received: from mail.kdab.com ([176.9.126.58]:11120 "EHLO mail.kdab.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1726315AbfFCMbr (ORCPT <rfc822;linux-bluetooth@vger.kernel.org>);
        Mon, 3 Jun 2019 08:31:47 -0400
X-Greylist: delayed 456 seconds by postgrey-1.27 at vger.kernel.org; Mon, 03 Jun 2019 08:31:46 EDT
Authentication-Results: mail.kdab.com (amavisd-new); dkim=pass (1024-bit key)
 reason="pass (just generated,
 assumed good)" header.d=kdab.com
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=kdab.com; h=
 content-transfer-encoding:content-language:content-type
 :content-type:mime-version:date:date:message-id:subject:subject
 :from:from; s=dkim; t=1559564647; x=1560428648; bh=5rtddyVFK/0cG
 cIuC/IoBDgvGsxBxmUZTB1PiopW4wA=; b=iCxBll5ewRH30tUVpW7M6JFmaenGI
 gWuDpCZehRbPad0p8nZ9m0d8XCZTOHGCf8JwHCGdpv0EKE6v4BbQIU+D4QYq+G5R
 YzOqiA8D5Fhwo+KOETCPAta+a909jdTDaAOEanPD8enjM/y1bbtujVvLh5MhOKjs
 6oCyZ0SJwR5lik=
X-Virus-Scanned: amavisd-new at kdab.com
To:     linux-bluetooth@vger.kernel.org
From:   Zeno Endemann <zeno.endemann@kdab.com>
Subject: DBus API clarification about security
Message-ID: <d7ca4d07-2937-11a3-0156-f18906f6fb1c@kdab.com>
Date:   Mon, 3 Jun 2019 14:24:06 +0200
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
Sender: linux-bluetooth-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-bluetooth.vger.kernel.org>
X-Mailing-List: linux-bluetooth@vger.kernel.org

Hello,

I was trying to implement a BTLE Peripheral with characteristics only
accessible to paired devices.

IIUC for read/write characteristics, one is supposed to set the
"encrypt-read/write" org.bluez.GattCharacteristic1 "Flags" property, and
for notify/indicate characteristics the CCCD needs to have the
"encrypt-write" flags set instead. Is this correct?

The CCCD for a characteristic is apparently automatically generated by
bluez, so how is one supposed to override that? I tried to add a CCCD
manually to the example-gatt-server, like this:

class ClientCharacteristicConfigurationDescriptor(Descriptor):
    CCCD_UUID = '2902'
    def __init__(self, bus, index, characteristic):
        self.value = [dbus.Byte(0), dbus.Byte(0)]
        Descriptor.__init__(self, bus, index, self.CCCD_UUID,
                ['read', 'encrypt-write'], characteristic)
    def ReadValue(self, options):
        return self.value
    def WriteValue(self, value, options):
        self.value = value

But that didn't seem to work.

On that note, I wasn't really able to find documentation about those
flags (e.g. the difference between "encrypt-read",
"encrypt-authenticated-read", and "secure-read"). I assume these map
directly to some bluetooth specifications, which I have to admit not
knowing much about. But I was hoping to find some application developer
guidelines or similar publicly available documents, and not having to
study some long complicated specification first.

Any hints would be much appreciated.

Thanks,

-- 
Zeno Endemann | zeno.endemann@kdab.com | Software Engineer
KDAB (Deutschland) GmbH, a KDAB Group company
Tel: +49-30-521325470
KDAB - The Qt Experts
