Return-Path: <linux-bluetooth-owner@vger.kernel.org>
X-Original-To: lists+linux-bluetooth@lfdr.de
Delivered-To: lists+linux-bluetooth@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id D6E5C1EE482
	for <lists+linux-bluetooth@lfdr.de>; Thu,  4 Jun 2020 14:36:27 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726565AbgFDMg1 (ORCPT <rfc822;lists+linux-bluetooth@lfdr.de>);
        Thu, 4 Jun 2020 08:36:27 -0400
Received: from mxout04.lancloud.ru ([89.108.124.63]:47422 "EHLO
        mxout04.lancloud.ru" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726112AbgFDMg1 (ORCPT
        <rfc822;linux-bluetooth@vger.kernel.org>);
        Thu, 4 Jun 2020 08:36:27 -0400
X-Greylist: delayed 522 seconds by postgrey-1.27 at vger.kernel.org; Thu, 04 Jun 2020 08:36:24 EDT
Received: from LanCloud
DKIM-Filter: OpenDKIM Filter v2.11.0 mxout04.lancloud.ru 3DEB62071707
Received: from LanCloud
Received: from LanCloud
Received: from LanCloud
From:   Denis Grigorev <d.grigorev@omprussia.ru>
To:     "linux-bluetooth@vger.kernel.org" <linux-bluetooth@vger.kernel.org>
Subject: [PATCH] gobex: Fix segfault caused by interrupted transfer
Thread-Topic: [PATCH] gobex: Fix segfault caused by interrupted transfer
Thread-Index: AQHWOmuJh2TkW+5veUuwo0zjkjERyg==
Date:   Thu, 4 Jun 2020 12:27:39 +0000
Message-ID: <a86f93d2d5a946d86bcdccb52218f20a959434cd.camel@omprussia.ru>
Accept-Language: ru-RU, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-exchange-transport-fromentityheader: Hosted
x-originating-ip: [192.168.11.137]
Content-Type: text/plain; charset="utf-8"
Content-ID: <B367C4676B214A4294BEC970726575CE@lancloud.ru>
Content-Transfer-Encoding: base64
MIME-Version: 1.0
Sender: linux-bluetooth-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-bluetooth.vger.kernel.org>
X-Mailing-List: linux-bluetooth@vger.kernel.org

V2hlbiBhIG9iZXggdHJhbnNmZXIgaXMgaW50ZXJydXB0ZWQgYnkgYSBwZWVyIGluIHRoZSBtaWRk
bGUsIHRoZSByZXNwb25zZQ0KR19PQkVYX1JTUF9GT1JCSURERU4gY29tZXMgYW5kIHRoZSB0cmFu
c2ZlciBpcyBmcmVlZCBpbiB0cmFuc2Zlcl9jb21wbGV0ZS4NCkhvd2V2ZXIgZ29iZXggaXMgc3Rp
bGwgcmVmJ2VkIGFuZCBnb2JleC0+aW8gY29udGludWVzIHRvIGJlIHdyaXRhYmxlLA0Kc28gd3Jp
dGVfZGF0YSgpIGFuZCwgaWYgYSB0eCBwYWNrZXQgd2FzIHF1ZXVlZCwgcHV0X2dldF9kYXRhKCkg
YW5kIHRoZW4NCmdfb2JleF9hYm9ydCgpIGFyZSBjYWxsZWQuIFdoZW4gdGhlIGFib3J0IHJlc3Bv
bnNlIGNvbWVzLCB0aGUgZGF0YSBvZg0KY29tcGxldGVfZnVuYyBjYWxsYmFjayBpcyBhbHJlYWR5
IGZyZWVkLCB3aGljaCBsZWFkcyB0byB0aGUgY3Jhc2guDQoNCkJhY2t0cmFjZSA6DQpfX0dJX19f
cHRocmVhZF9tdXRleF9sb2NrIChtdXRleD0weDY1NzMyZjc0KSBhdCBwdGhyZWFkX211dGV4X2xv
Y2suYzo2Nw0KMHhlY2M2ZWVkYSBpbiBkYnVzX2Nvbm5lY3Rpb25fZ2V0X29iamVjdF9wYXRoX2Rh
dGEgKCkgZnJvbSAvdXNyL2xpYi9saWJkYnVzLTEuc28uMw0KMHgwMDA0NTdkNCBpbiBnX2RidXNf
ZW1pdF9wcm9wZXJ0eV9jaGFuZ2VkX2Z1bGwgKCkgYXQgZ2RidXMvb2JqZWN0LmM6MTc5NA0KMHgw
MDA0NTg2OCBpbiBnX2RidXNfZW1pdF9wcm9wZXJ0eV9jaGFuZ2VkICgpIGF0IGdkYnVzL29iamVj
dC5jOjE4MzINCjB4MDAwMzY3ZjAgaW4gdHJhbnNmZXJfc2V0X3N0YXR1cyAoKSBhdCBvYmV4ZC9j
bGllbnQvdHJhbnNmZXIuYzoyMTENCjB4MDAwMzY4MWUgaW4gdHJhbnNmZXJfc2V0X3N0YXR1cyAo
KSBhdCBvYmV4ZC9jbGllbnQvdHJhbnNmZXIuYzoyMDYNCnhmZXJfY29tcGxldGUgKCkgYXQgb2Jl
eGQvY2xpZW50L3RyYW5zZmVyLmM6NjcyDQoweDAwMDIyZGY2IGluIHRyYW5zZmVyX2NvbXBsZXRl
ICgpIGF0IGdvYmV4L2dvYmV4LXRyYW5zZmVyLmM6MTAzDQoweDAwMDIyZjQ0IGluIHRyYW5zZmVy
X2Fib3J0X3Jlc3BvbnNlICgpIGF0IGdvYmV4L2dvYmV4LXRyYW5zZmVyLmM6MTI0DQoweDAwMDIw
YTBlIGluIGhhbmRsZV9yZXNwb25zZSAoKSBhdCBnb2JleC9nb2JleC5jOjExMjgNCjB4MDAwMjBk
ZGUgaW4gaW5jb21pbmdfZGF0YSAoKSBhdCBnb2JleC9nb2JleC5jOjEzNzMNCg0KVGhpcyBjb21t
aXQgaW50cm9kdWNlcyBnX29iZXhfZHJvcF90eF9xdWV1ZSgpLCB3aGljaCB3aWxsIGJlIGNhbGxl
ZCBpZg0KYSB0cmFuc2ZlciBlcnJvciBkZXRlY3RlZC4gQWZ0ZXIgdGhlIHR4IHF1ZXVlIGlzIGRy
b3BwZWQsIG9iZXggc2h1dHMgZG93bg0KZ3JhY2VmdWxseS4NCg0KVG8gYmUgYWJsZSB0byBjbG9z
ZSBMMkNBUCBjb25uZWN0aW9uIHdoZW4gdGhlcmUgYXJlIHBlbmRpbmcgZnJhbWVzLA0KTGludXgg
a2VybmVscyBiZWxvdyB2NC4zIG11c3QgaGF2ZSB0aGUgZm9sbG93aW5nIGNvbW1pdHMgY2hlcnJ5
LXBpY2tlZDoNCg0KMmJhZWE4NWRlYzFhZWJlMGIxMDBkNDgzNmRlZThiY2YyOWE1MWU5NCAtIEJs
dWV0b290aDogTDJDQVAgRVJUTSBzaHV0ZG93biBwcm90ZWN0IHNrIGFuZCBjaGFuDQpmNjU0Njhm
NmUyNmMzYmQwNWU2NDJlMTBlODBhNDg1Yjk5YjdkZTA1IC0gQmx1ZXRvb3RoOiBNYWtlIF9fbDJj
YXBfd2FpdF9hY2sgbW9yZSBlZmZpY2llbnQNCjQ1MWU0YzZjNmIzZmQxYTlmNDQ2YTEwZWI5ZjZk
NGMyYzQ3NjA0M2MgLSBCbHVldG9vdGg6IEFkZCBCVF9EQkcgdG8gbDJjYXBfc29ja19zaHV0ZG93
bigpDQpjYjAyYTI1NTgzYjU5Y2U0ODI2NzQ3MmNkMDkyNDg1ZDc1NDk2NGY5IC0gQmx1ZXRvb3Ro
OiBfX2wyY2FwX3dhaXRfYWNrKCkgdXNlIG1zZWNzX3RvX2ppZmZpZXMoKQ0KZTQzMmM3MmM0NjRk
MmRlYjZjNjZkMWUyYTVmNTQ4ZGMxZjBlZjRkYyAtIEJsdWV0b290aDogX19sMmNhcF93YWl0X2Fj
aygpIGFkZCBkZWZlbnNpdmUgdGltZW91dA0KZTc0NTY0MzdjMTVhMmZkNDJjZWRkMjVjMmIxMmIw
Njg3NmYyODVmMCAtIEJsdWV0b290aDogVW53aW5kIGwyY2FwX3NvY2tfc2h1dGRvd24oKQ0KMDRi
YTcyZTZiMjRmMWUwZTIyMjFmY2Q3M2YwODc4Mjg3MDQ3M2ZhMSAtIEJsdWV0b290aDogUmVvcmdh
bml6ZSBtdXRleCBsb2NrIGluIGwyY2FwX3NvY2tfc2h1dGRvd24oKQ0KOWY3Mzc4YTlkNmNlZDE3
ODRlMDhkM2UyMWE5ZGRiNzY5NTIzYmFmMiAtIEJsdWV0b290aDogbDJjYXBfZGlzY29ubmVjdGlv
bl9yZXEgcHJpb3JpdHkgb3ZlciBzaHV0ZG93bg0KDQpTaWduZWQtb2ZmLWJ5OiBEZW5pcyBHcmln
b3JldiA8ZC5ncmlnb3JldkBvbXBydXNzaWEucnU+DQotLS0NCiBnb2JleC9nb2JleC10cmFuc2Zl
ci5jIHwgIDUgKysrKysNCiBnb2JleC9nb2JleC5jICAgICAgICAgIHwgMTAgKysrKysrKysrKw0K
IGdvYmV4L2dvYmV4LmggICAgICAgICAgfCAgMSArDQogMyBmaWxlcyBjaGFuZ2VkLCAxNiBpbnNl
cnRpb25zKCspDQoNCmRpZmYgLS1naXQgYS9nb2JleC9nb2JleC10cmFuc2Zlci5jIGIvZ29iZXgv
Z29iZXgtdHJhbnNmZXIuYw0KaW5kZXggYmM5OTMwNjc5Li5lOTZlNjFmYmMgMTAwNjQ0DQotLS0g
YS9nb2JleC9nb2JleC10cmFuc2Zlci5jDQorKysgYi9nb2JleC9nb2JleC10cmFuc2Zlci5jDQpA
QCAtMTAwLDYgKzEwMCwxMSBAQCBzdGF0aWMgdm9pZCB0cmFuc2Zlcl9jb21wbGV0ZShzdHJ1Y3Qg
dHJhbnNmZXIgKnRyYW5zZmVyLCBHRXJyb3IgKmVycikNCiANCiAJZ19vYmV4X2RlYnVnKEdfT0JF
WF9ERUJVR19UUkFOU0ZFUiwgInRyYW5zZmVyICV1IiwgaWQpOw0KIA0KKwlpZiAoZXJyKSB7DQor
CQkvKiBObyBmdXJ0aGVyIHR4IG11c3QgYmUgcGVyZm9ybWVkICovDQorCQlnX29iZXhfZHJvcF90
eF9xdWV1ZSh0cmFuc2Zlci0+b2JleCk7DQorCX0NCisNCiAJdHJhbnNmZXItPmNvbXBsZXRlX2Z1
bmModHJhbnNmZXItPm9iZXgsIGVyciwgdHJhbnNmZXItPnVzZXJfZGF0YSk7DQogCS8qIENoZWNr
IGlmIHRoZSBjb21wbGV0ZV9mdW5jIHJlbW92ZWQgdGhlIHRyYW5zZmVyICovDQogCWlmIChmaW5k
X3RyYW5zZmVyKGlkKSA9PSBOVUxMKQ0KZGlmZiAtLWdpdCBhL2dvYmV4L2dvYmV4LmMgYi9nb2Jl
eC9nb2JleC5jDQppbmRleCA3N2YxYWFhZmQuLmQ2OGE4NWViNiAxMDA2NDQNCi0tLSBhL2dvYmV4
L2dvYmV4LmMNCisrKyBiL2dvYmV4L2dvYmV4LmMNCkBAIC01MjEsNiArNTIxLDE2IEBAIHN0YXRp
YyB2b2lkIGVuYWJsZV90eChHT2JleCAqb2JleCkNCiAJb2JleC0+d3JpdGVfc291cmNlID0gZ19p
b19hZGRfd2F0Y2gob2JleC0+aW8sIGNvbmQsIHdyaXRlX2RhdGEsIG9iZXgpOw0KIH0NCiANCit2
b2lkIGdfb2JleF9kcm9wX3R4X3F1ZXVlKEdPYmV4ICpvYmV4KQ0KK3sNCisJc3RydWN0IHBlbmRp
bmdfcGt0ICpwOw0KKw0KKwlnX29iZXhfZGVidWcoR19PQkVYX0RFQlVHX0NPTU1BTkQsICIiKTsN
CisNCisJd2hpbGUgKChwID0gZ19xdWV1ZV9wb3BfaGVhZChvYmV4LT50eF9xdWV1ZSkpKQ0KKwkJ
cGVuZGluZ19wa3RfZnJlZShwKTsNCit9DQorDQogc3RhdGljIGdib29sZWFuIGdfb2JleF9zZW5k
X2ludGVybmFsKEdPYmV4ICpvYmV4LCBzdHJ1Y3QgcGVuZGluZ19wa3QgKnAsDQogCQkJCQkJCQlH
RXJyb3IgKiplcnIpDQogew0KZGlmZiAtLWdpdCBhL2dvYmV4L2dvYmV4LmggYi9nb2JleC9nb2Jl
eC5oDQppbmRleCBiMjIzYTJmYWMuLmE5NGQ5MjQ2ZSAxMDA2NDQNCi0tLSBhL2dvYmV4L2dvYmV4
LmgNCisrKyBiL2dvYmV4L2dvYmV4LmgNCkBAIC02Myw2ICs2Myw3IEBAIGdib29sZWFuIGdfb2Jl
eF9yZW1vdmVfcmVxdWVzdF9mdW5jdGlvbihHT2JleCAqb2JleCwgZ3VpbnQgaWQpOw0KIHZvaWQg
Z19vYmV4X3N1c3BlbmQoR09iZXggKm9iZXgpOw0KIHZvaWQgZ19vYmV4X3Jlc3VtZShHT2JleCAq
b2JleCk7DQogZ2Jvb2xlYW4gZ19vYmV4X3NybV9hY3RpdmUoR09iZXggKm9iZXgpOw0KK3ZvaWQg
Z19vYmV4X2Ryb3BfdHhfcXVldWUoR09iZXggKm9iZXgpOw0KIA0KIEdPYmV4ICpnX29iZXhfbmV3
KEdJT0NoYW5uZWwgKmlvLCBHT2JleFRyYW5zcG9ydFR5cGUgdHJhbnNwb3J0X3R5cGUsDQogCQkJ
CQkJZ3NzaXplIHJ4X210dSwgZ3NzaXplIHR4X210dSk7DQotLSANCjIuMTcuMQ0K
